<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ARGUS SPEAK LAB-X ‚Äî Avatar Beta</title>
  <style>
    body{font-family:Arial,system-ui,sans-serif;margin:0;padding:16px;background:#0b1220;color:#e8eefc}
    .card{max-width:820px;margin:0 auto;background:#0f1b34;border:1px solid rgba(255,255,255,.08);
      border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    button{padding:12px 16px;border-radius:12px;border:1px solid rgba(255,255,255,.14);
      background:#15284f;color:#fff;font-size:16px;cursor:pointer}
    button:active{transform:scale(.99)}
    #voiceStatus{margin-top:10px;opacity:.9}
    pre{white-space:pre-wrap;background:rgba(255,255,255,.06);padding:12px;border-radius:12px;min-height:150px}
    .hint{opacity:.7;font-size:13px;margin-top:6px}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.08);font-size:12px}
  </style>
</head>

<body>
  <div class="card">
    <div class="row" style="justify-content:space-between;">
      <h2 style="margin:0;">üéôÔ∏è Avatar Beta (Voz ‚Üí IA ‚Üí Voz)</h2>
      <span class="pill" id="apiStatus">API: ...</span>
    </div>

    <div class="hint">
      Mant√©n presionado para hablar. Si no detecta voz, habla 2‚Äì3s cerca del mic.
    </div>

    <div class="row" style="margin-top:12px;">
      <button id="btnHold">Mant√©n presionado para hablar</button>
      <button id="btnTestChat">Probar Chat (texto)</button>
      <button id="btnClear">Limpiar</button>
    </div>

    <div id="voiceStatus">Estado: idle</div>

    <h3 style="margin:14px 0 8px 0;">Log</h3>
    <pre id="voiceLog"></pre>
  </div>

  <!-- ORDEN CORRECTO + cache-bust -->
  <script src="./voicePipeline.js?v=200"></script>
  <script src="./voiceRecorder.js?v=200"></script>

  <script>
    const statusEl = document.getElementById("voiceStatus");
    const logEl = document.getElementById("voiceLog");
    const apiEl = document.getElementById("apiStatus");

    window.__voiceState = (s) => statusEl.textContent = "Estado: " + s;
    window.__voiceLog = (who, text) => {
      const line = `${who}: ${text}`;
      logEl.textContent = (logEl.textContent + "\n" + line).trim();
    };

    document.getElementById("btnClear").addEventListener("click", () => {
      logEl.textContent = "";
      window.__voiceState("idle");
    });

    const btn = document.getElementById("btnHold");
    btn.addEventListener("mousedown", () => window.VX_startRec());
    btn.addEventListener("mouseup", () => window.VX_runVoiceTurn());
    btn.addEventListener("touchstart", (e) => { e.preventDefault(); window.VX_startRec(); }, { passive:false });
    btn.addEventListener("touchend", (e) => { e.preventDefault(); window.VX_runVoiceTurn(); }, { passive:false });

    document.getElementById("btnTestChat").addEventListener("click", async () => {
      try {
        const reply = await window.VX_chatReply("Hello! Correct my English: I no have time yesterday.");
        window.__voiceLog("BOT", reply);
      } catch (e) {
        alert("Chat test failed: " + (e?.message || e));
      }
    });

    // Mini check r√°pido
    apiEl.textContent = "API: " + [
      "STT " + (typeof window.VX_transcribeAudio),
      "CHAT " + (typeof window.VX_chatReply),
      "TTS " + (typeof window.VX_ttsAudio)
    ].join(" | ");

    console.log("‚úÖ index wired", {
      VX_transcribeAudio: typeof window.VX_transcribeAudio,
      VX_chatReply: typeof window.VX_chatReply,
      VX_ttsAudio: typeof window.VX_ttsAudio
    });
  </script>
</body>
</html>

